;;; Python-Tools -- Summary:
;;; Commentary:
;;; configuration of python editing packages for Emacs
;;; generated by Zach Maas

;;; Code:

;; Python Development Setup
;; IN PROGRESS - anaconda is good so far, some lag that needs to be figured out
(use-package anaconda-mode
	:ensure t
	:diminish	anaconda-mode
	:init
	(use-package pyvenv
		:ensure t
		:config)
	:config
	(add-hook 'python-mode-hook #'anaconda-mode)
	(setq python-shell-interpreter "python3"
				python-shell-interpreter-args "")
  (when (executable-find "ipython")
    (setq python-shell-interpreter "ipython"
          python-shell-interpreter-args "-i --simple-prompt --no-color-info"
          python-shell-prompt-regexp "In \\[[0-9]+\\]: "
          python-shell-prompt-block-regexp "\\.\\.\\.\\.: "
          python-shell-prompt-output-regexp "Out\\[[0-9]+\\]: "
          python-shell-completion-setup-code
          "from IPython.core.completerlib import module_completion"
          python-shell-completion-string-code
          "';'.join(get_ipython().Completer.all_completions('''%s'''))\n")))

;; (use-package company-anaconda
;; 	:ensure t
;; 	:config
;; 	(add-hook 'python-mode-hook 'anaconda-mode)
;; 	(add-hook 'python-mode-hook #'(lambda ()
;; 																	(add-to-list 'company-backends 'company-anaconda)))
;; 	(add-hook 'anaconda-mode-hook #'anaconda-eldoc-mode))

(use-package lsp-python-ms
	:ensure t
	:config
  (setq lsp-python-ms-executable
        "/usr/bin/mspyls")
	(add-hook 'python-mode-hook #'lsp))

;; Sphinx-doc -- Automagically add docstrings to python	functions
(use-package sphinx-doc
	:ensure t
	:diminish	""
	:config
	(add-hook 'python-mode-hook (lambda  () (sphinx-doc-mode t))))

;; Yapfify -- Better formatter
;; (use-package yapfify
;; 	:ensure t
;; 	:config
;; 	(add-hook 'python-mode-hook #'yapf-mode))

(use-package blacken
	:ensure t
	:config
	(setq blacken-line-length 80
				blacken-allow-py36 t)
	(add-hook 'python-mode-hook #'blacken-mode))

;; EIN - Emacs Ipython Notebooks
(use-package ein
	:ensure t)

;; Mode	keybinds
(general-define-key
 :states '(normal visual insert emacs)
 :keymaps '(python-mode-map inferior-python-mode-map)
 :prefix "SPC"
 :non-normal-prefix "M-SPC"
 "l" '(:ignore t :which-key "layer")
 "lr" '(run-python :which-key "python repl")
 "lf" '(yapfify-buffer :which-key "autoformat")
 "ll" '(python-shell-send-statement :which-key "eval region")
 "lc" '(comint-clear-buffer :which-key "clear repl")
 "le" '(python-shell-send-buffer :which-key "eval buffer")
 "lE" '(python-shell-send-defun :which-key "eval defun")
 "ld" '(anaconda-mode-find-definitions :which-key "def")
 "lD" '(sphinx-doc :which-key "add docs")
 "l?" '(anaconda-mode-show-doc :which-key "docs?")
 "lv" '(pyvenv-workon :which-key "venv-on")
 "lV" '(pyvenv-deactivate :which-key "venv-off"))

;;; zm-python-tools.el ends here
